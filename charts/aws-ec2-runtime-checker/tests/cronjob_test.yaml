suite: test cronjob
templates:
  - cronjob.yaml
tests:
  - it: should create a CronJob when kind is CronJob
    set:
      kind: CronJob
      schedule: "0 */6 * * *"
    asserts:
      - isKind:
          of: CronJob
      - equal:
          path: metadata.name
          value: RELEASE-NAME-aws-ec2-runtime-checker

  - it: should set correct schedule
    set:
      kind: CronJob
      schedule: "0 */6 * * *"
    asserts:
      - equal:
          path: spec.schedule
          value: "0 */6 * * *"

  - it: should set environment variables correctly
    set:
      kind: CronJob
      aws:
        region: eu-west-1
      dryRun: true
    asserts:
      - contains:
          path: spec.jobTemplate.spec.template.spec.containers[0].env
          content:
            name: AWS_REGION
            value: eu-west-1
      - contains:
          path: spec.jobTemplate.spec.template.spec.containers[0].env
          content:
            name: DRY_RUN
            value: "true"

  - it: should mount config volume
    set:
      kind: CronJob
    asserts:
      - contains:
          path: spec.jobTemplate.spec.template.spec.containers[0].volumeMounts
          content:
            name: config-volume
            mountPath: /app/config
      - contains:
          path: spec.jobTemplate.spec.template.spec.volumes
          content:
            name: config-volume
            configMap:
              name: RELEASE-NAME-aws-ec2-runtime-checker-config
