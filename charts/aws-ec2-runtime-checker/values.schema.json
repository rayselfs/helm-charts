{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "AWS EC2 Runtime Checker Values",
  "description": "Schema for validating aws-ec2-runtime-checker Helm chart values",
  "properties": {
    "replicaCount": {
      "type": "integer",
      "description": "Number of replicas to deploy. Only applicable when kind is Deployment",
      "minimum": 1,
      "default": 1
    },
    "kind": {
      "type": "string",
      "description": "Deployment kind: Deployment or CronJob",
      "enum": ["Deployment", "CronJob"],
      "default": "Deployment"
    },
    "schedule": {
      "type": "string",
      "description": "Cron schedule expression (required for both Deployment and CronJob modes)",
      "pattern": "^[0-9*/-]+\\s+[0-9*/-]+\\s+[0-9*/-]+\\s+[0-9*/-]+\\s+[0-9*/-]+$",
      "default": "0 * * * *"
    },
    "cronJob": {
      "type": "object",
      "description": "CronJob specific configuration. Only applicable when kind is CronJob",
      "properties": {
        "concurrencyPolicy": {
          "type": "string",
          "description": "Concurrency policy for CronJob",
          "enum": ["Allow", "Forbid", "Replace"],
          "default": "Forbid"
        },
        "failedJobsHistoryLimit": {
          "type": "integer",
          "description": "Number of failed jobs to keep in history",
          "minimum": 0,
          "default": 3
        },
        "successfulJobsHistoryLimit": {
          "type": "integer",
          "description": "Number of successful jobs to keep in history",
          "minimum": 0,
          "default": 3
        },
        "startingDeadlineSeconds": {
          "type": ["integer", "null"],
          "description": "Optional deadline in seconds for starting the job if it misses scheduled time",
          "minimum": 0
        },
        "suspend": {
          "type": "boolean",
          "description": "Suspend the CronJob. When true, the CronJob will not create any new jobs",
          "default": false
        },
        "timeZone": {
          "type": ["string", "null"],
          "description": "Time zone name for the schedule (Kubernetes 1.24+). Example: America/New_York, UTC, Asia/Taipei"
        }
      }
    },
    "image": {
      "type": "object",
      "description": "Container image configuration",
      "properties": {
        "repository": {
          "type": "string",
          "description": "Image repository"
        },
        "pullPolicy": {
          "type": "string",
          "description": "Image pull policy",
          "enum": ["Always", "IfNotPresent", "Never"],
          "default": "IfNotPresent"
        },
        "tag": {
          "type": "string",
          "description": "Image tag (defaults to chart appVersion)"
        }
      }
    },
    "imagePullSecrets": {
      "type": "array",
      "description": "Image pull secrets for private registries",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          }
        }
      }
    },
    "nameOverride": {
      "type": "string",
      "description": "Override the name of the chart"
    },
    "fullnameOverride": {
      "type": "string",
      "description": "Override the full name of the release"
    },
    "serviceAccount": {
      "type": "object",
      "description": "Service account configuration",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Specifies whether a service account should be created",
          "default": true
        },
        "annotations": {
          "type": "object",
          "description": "Annotations to add to the service account",
          "additionalProperties": {
            "type": "string"
          }
        },
        "name": {
          "type": "string",
          "description": "The name of the service account to use. If not set, the release name will be used"
        }
      }
    },
    "podAnnotations": {
      "type": "object",
      "description": "Annotations to add to the pod",
      "additionalProperties": {
        "type": "string"
      }
    },
    "podSecurityContext": {
      "type": "object",
      "description": "Pod security context"
    },
    "securityContext": {
      "type": "object",
      "description": "Container security context"
    },
    "resources": {
      "type": "object",
      "description": "Resource limits and requests",
      "properties": {
        "limits": {
          "type": "object",
          "description": "Resource limits",
          "properties": {
            "cpu": {
              "type": "string"
            },
            "memory": {
              "type": "string"
            }
          }
        },
        "requests": {
          "type": "object",
          "description": "Resource requests",
          "properties": {
            "cpu": {
              "type": "string"
            },
            "memory": {
              "type": "string"
            }
          }
        }
      }
    },
    "nodeSelector": {
      "type": "object",
      "description": "Node selector for pod assignment",
      "additionalProperties": {
        "type": "string"
      }
    },
    "tolerations": {
      "type": "array",
      "description": "Tolerations for pod assignment",
      "items": {
        "type": "object"
      }
    },
    "affinity": {
      "type": "object",
      "description": "Affinity rules for pod assignment"
    },
    "leaderElection": {
      "type": "object",
      "description": "Leader election configuration. Required when kind is Deployment and replicaCount > 1",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable leader election",
          "default": false
        },
        "leaseName": {
          "type": "string",
          "description": "Name of the lease resource. If empty, defaults to ec2-checker-leader"
        }
      }
    },
    "pdb": {
      "type": "object",
      "description": "Pod Disruption Budget configuration",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Create a PodDisruptionBudget",
          "default": false
        },
        "minAvailable": {
          "type": ["integer", "string"],
          "description": "Minimum number of pods that must be available",
          "minimum": 0
        },
        "maxUnavailable": {
          "type": ["integer", "string"],
          "description": "Maximum number of pods that can be unavailable",
          "minimum": 0
        }
      }
    },
    "aws": {
      "type": "object",
      "description": "AWS configuration",
      "required": ["region"],
      "properties": {
        "region": {
          "type": "string",
          "description": "AWS region where EC2 instances are located"
        },
        "accessKeyId": {
          "type": "string",
          "description": "AWS Access Key ID (optional, use IRSA instead for EKS)"
        },
        "secretAccessKey": {
          "type": "string",
          "description": "AWS Secret Access Key (optional, use IRSA instead for EKS)"
        },
        "vpcId": {
          "type": "string",
          "description": "VPC ID to filter EC2 instances (optional). If set, only instances in this VPC will be checked"
        }
      }
    },
    "snsTopicArn": {
      "type": "string",
      "description": "SNS topic ARN for notifications (optional). If set, sends notifications before terminating instances",
      "oneOf": [
        {
          "pattern": "^arn:aws:sns:[a-z0-9-]+:[0-9]{12}:[a-zA-Z0-9_-]+$"
        },
        {
          "enum": [""]
        }
      ]
    },
    "dryRun": {
      "type": "boolean",
      "description": "Dry run mode. When true, instances are NOT terminated, only logged",
      "default": true
    },
    "targets": {
      "type": "array",
      "description": "Target EC2 instance types and their maximum runtime thresholds. Each entry can filter by instanceType, name pattern (supports wildcard *), tags, or any combination",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["maxRuntimeHours"],
        "properties": {
          "instanceType": {
            "type": "string",
            "description": "Filter by EC2 instance type (optional, e.g., t2.micro, t3.micro, c5.large)"
          },
          "name": {
            "type": "string",
            "description": "Filter by instance name (Name tag, supports wildcard matching with *). Example: my-instance-*, prod-*"
          },
          "tags": {
            "type": "object",
            "description": "Filter by tags (key-value pairs, all must match). Example: {\"Environment\": \"dev\", \"Team\": \"backend\"}",
            "additionalProperties": {
              "type": "string"
            }
          },
          "maxRuntimeHours": {
            "type": "number",
            "description": "Maximum runtime in hours before instance should be terminated",
            "minimum": 0.1
          }
        }
      }
    }
  },
  "required": [
    "aws",
    "schedule",
    "kind",
    "targets"
  ]
}

